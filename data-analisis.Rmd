---
title: "R Notebook"
output: html_notebook
---

# Load the data

In this section we load the data and generate the dataframes we analyze throughout this notebook.

We next load the required libraries for the remained of this notebook.

```{r}
library(dplyr)
library(ggplot2)
library(latex2exp)
library(plotrix)
library(scales)
library(plyr)
library(purrr)
library(data.table)
library(stringi)
#remotes::install_github("coolbutuseless/ggpattern")
#library("ggpattern")
library(patternplot)

get.se <- function(y) {
 se <- sd(y)/sqrt(length(y))
 mu <- mean(y)
 c(ymin=mu-se, ymax=mu+se)
}
```

Load the data.

```{r}
time_results <- 
    list.files(path = "results", pattern = "*.csv", full.names = TRUE) %>% 
    map_df(~fread(.))

time_results$time <- with(time_results, time * 1000)

tpch.plot_select_by_template <- function(template_id) {
  p <- ggplot(time_results %>% filter(time < 300000
                                       & status == 200
                                       & template == template_id
                                       & !grepl("construct", mode)),
    aes(x=scale_factor, y=time, fill=mode)) +
    ggtitle(paste("Query template", template_id)) +
    facet_wrap(~engine, ncol = 2) +
    stat_summary(fun=mean, geom="bar",
                 position=position_dodge(preserve="single"), color="grey70") +
    scale_x_continuous(trans='log10',
                       labels=trans_format("log10", math_format(10^.x))) +
    scale_y_continuous(trans='log10',
                       labels=trans_format("log10", math_format(10^.x))) +
    xlab("scale factor") + ylab("time (ms)") +
    # theme_classic()
    # theme_linedraw()
    # theme_light()
    theme_bw(base_family = "Times")

  #  geom_bar_pattern(stat = "identity",
  #                   pattern_color = "white",
  #                   pattern_fill = "black",
  #                   aes(pattern = group)) +
  # scale_fill_manual(labels=labs,values=c("#009E73","#CC79A7","#0072B2")) +
  # scale_fill_brewer(palette="OrRd")

  p
}
```

Plot data by query.

```{r}
p01 <- tpch.plot_select_by_template(1)
p01

png(file="plots/select_for_query_template_01.png",
    res=500, width=6000, height=2400, pointsize=1)
p01
dev.off()

p03 <- tpch.plot_select_by_template(3)
p03

png(file="plots/select_for_query_template_03.png",
    res=500, width=6000, height=2400, pointsize=1)
p03
dev.off()

p05 <- tpch.plot_select_by_template(5)
p05

png(file="plots/select_for_query_template_05.png",
    res=500, width=6000, height=2400, pointsize=1)
p05
dev.off()

p06 <- tpch.plot_select_by_template(6)
p06

png(file="plots/select_for_query_template_06.png",
    res=500, width=6000, height=2400, pointsize=1)
p06
dev.off()

p07 <- tpch.plot_select_by_template(7)
p07

png(file="plots/select_for_query_template_07.png",
    res=500, width=6000, height=2400, pointsize=1)
p07
dev.off()

p08 <- tpch.plot_select_by_template(8)
p08

png(file="plots/select_for_query_template_08.png",
    res=500, width=6000, height=2400, pointsize=1)
p08
dev.off()

p09 <- tpch.plot_select_by_template(9)
p09

png(file="plots/select_for_query_template_09.png",
    res=500, width=6000, height=2400, pointsize=1)
p09
dev.off()

p10 <- tpch.plot_select_by_template(10)
p10

png(file="plots/select_for_query_template_10.png",
    res=500, width=6000, height=2400, pointsize=1)
p10
dev.off()

p12 <- tpch.plot_select_by_template(12)
p12

png(file="plots/select_for_query_template_12.png",
    res=500, width=6000, height=2400, pointsize=1)
p12
dev.off()

p14 <- tpch.plot_select_by_template(14)
p14

png(file="plots/select_for_query_template_14.png",
    res=500, width=6000, height=2400, pointsize=1)
p14
dev.off()

p19 <- tpch.plot_select_by_template(19)
p19

png(file="plots/select_for_query_template_19.png",
    res=500, width=6000, height=2400, pointsize=1)
p19
dev.off()
```
