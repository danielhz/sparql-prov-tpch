---
title: "R Notebook"
output: html_notebook
---

# Load the data

In this section we load the data and generate the dataframes we analyze throughout this notebook.

We next load the required libraries for the remained of this notebook.

```{r}
library(dplyr)
library(ggplot2)
library(latex2exp)
library(plotrix)
library(scales)
library(plyr)
library(purrr)
library(data.table)
library(stringi)
#remotes::install_github("coolbutuseless/ggpattern")
#library("ggpattern")
library(patternplot)

get.se <- function(y) {
 se <- sd(y)/sqrt(length(y))
 mu <- mean(y)
 c(ymin=mu-se, ymax=mu+se)
}
```

Load the data.

```{r}
time_results <- 
    list.files(path = "results", pattern = "*.csv", full.names = TRUE) %>% 
    map_df(~fread(.))

time_results$time <- with(time_results, time * 1000)

tpch.plot_select_by_template <- function(template_id) {
  p <- ggplot(time_results %>% filter(time < 300000
                                       & status == 200
                                       & template == template_id
                                       & !grepl("construct", mode)),
    aes(x=scale_factor, y=time, fill=mode)) +
    ggtitle(paste("Query template", template_id)) +
    facet_wrap(~engine, ncol = 2) +
    stat_summary(fun=mean, geom="bar",
                 position=position_dodge(preserve="single"), color="grey70") +
    scale_x_continuous(trans='log10',
                       labels=trans_format("log10", math_format(10^.x))) +
    scale_y_continuous(trans='log10',
                       labels=trans_format("log10", math_format(10^.x))) +
    xlab("scale factor") + ylab("time (ms)") +
    # theme_classic()
    # theme_linedraw()
    # theme_light()
    theme_bw()

  #  geom_bar_pattern(stat = "identity",
  #                   pattern_color = "white",
  #                   pattern_fill = "black",
  #                   aes(pattern = group)) +
  # scale_fill_manual(labels=labs,values=c("#009E73","#CC79A7","#0072B2")) +
  # scale_fill_brewer(palette="OrRd")

  p
}
```

Plot data by query.

```{r}
p01 <- tpch.plot_select_by_template(1)
p01
p03 <- tpch.plot_select_by_template(3)
p03
p05 <- tpch.plot_select_by_template(5)
p05
p06 <- tpch.plot_select_by_template(6)
p06
p07 <- tpch.plot_select_by_template(7)
p07
p08 <- tpch.plot_select_by_template(8)
p08
p09 <- tpch.plot_select_by_template(9)
p09
p10 <- tpch.plot_select_by_template(10)
p10
p12 <- tpch.plot_select_by_template(12)
p12
p14 <- tpch.plot_select_by_template(14)
p14
p19 <- tpch.plot_select_by_template(19)
p19
```
